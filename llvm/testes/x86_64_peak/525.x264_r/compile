#!/bin/bash

LLC=~/Code/Faculdade/tcc/llvm/build/bin/llc

cd ~/Code/Faculdade/tcc/llvm/testes/x86_64_peak/525.x264_r/build/build_peak_teste1-m64.0000

find . -type f -name "*.ll" -print | xargs -P 0 -i $LLC -O3 -filetype=obj --priority-function="$2" --regalloc=$1 {}

clang++ -no-pie -m64 -z muldefs -Ofast -mavx ldecod_src/nal.o ldecod_src/mbuffer_mvc.o ldecod_src/image.o ldecod_src/mb_access.o ldecod_src/memalloc.o ldecod_src/mc_prediction.o ldecod_src/mb_prediction.o ldecod_src/intra4x4_pred_mbaff.o ldecod_src/loop_filter_mbaff.o ldecod_src/context_ini.o ldecod_src/configfile.o ldecod_src/cabac.o ldecod_src/sei.o ldecod_src/leaky_bucket.o ldecod_src/filehandle.o ldecod_src/errorconcealment.o ldecod_src/decoder_test.o ldecod_src/img_process.o ldecod_src/mv_prediction.o ldecod_src/fmo.o ldecod_src/output.o ldecod_src/mc_direct.o ldecod_src/rtp.o ldecod_src/nalucommon.o ldecod_src/config_common.o ldecod_src/intra_chroma_pred.o ldecod_src/transform8x8.o ldecod_src/blk_prediction.o ldecod_src/intra8x8_pred_mbaff.o ldecod_src/erc_do_i.o ldecod_src/io_tiff.o ldecod_src/mbuffer.o ldecod_src/block.o ldecod_src/intra4x4_pred.o ldecod_src/transform.o ldecod_src/annexb.o ldecod_src/ldecod.o ldecod_src/macroblock.o ldecod_src/vlc.o ldecod_src/parset.o ldecod_src/loop_filter_normal.o ldecod_src/parsetcommon.o ldecod_src/erc_do_p.o ldecod_src/loopFilter.o ldecod_src/intra16x16_pred_mbaff.o ldecod_src/intra4x4_pred_normal.o ldecod_src/intra16x16_pred_normal.o ldecod_src/win32.o ldecod_src/intra16x16_pred.o ldecod_src/intra8x8_pred_normal.o ldecod_src/io_raw.o ldecod_src/img_io.o ldecod_src/nalu.o ldecod_src/quant.o ldecod_src/intra8x8_pred.o ldecod_src/erc_api.o ldecod_src/header.o ldecod_src/biaridecod.o ldecod_src/input.o -lm -o ../../run/run_peak_refrate_teste1-m64.0000/ldecod_r

clang -no-pie -m64 -z muldefs -Ofast -mavx image_validator/ImageValidator.o -lm -o ../../run/run_peak_refrate_teste1-m64.0000/imagevalidate_525

clang -no-pie -m64 -z muldefs -Ofast -mavx x264_src/common/mc.o x264_src/common/predict.o x264_src/common/pixel.o x264_src/common/macroblock.o x264_src/common/frame.o x264_src/common/dct.o x264_src/common/cpu.o x264_src/common/cabac.o x264_src/common/common.o x264_src/common/mdate.o x264_src/common/rectangle.o x264_src/common/set.o x264_src/common/quant.o x264_src/common/deblock.o x264_src/common/vlc.o x264_src/common/mvpred.o x264_src/encoder/analyse.o x264_src/encoder/me.o x264_src/encoder/ratecontrol.o x264_src/encoder/set.o x264_src/encoder/macroblock.o x264_src/encoder/cabac.o x264_src/encoder/cavlc.o x264_src/encoder/encoder.o x264_src/encoder/lookahead.o x264_src/input/timecode.o x264_src/input/yuv.o x264_src/input/y4m.o x264_src/output/raw.o x264_src/output/matroska.o x264_src/output/matroska_ebml.o x264_src/output/flv.o x264_src/output/flv_bytestream.o x264_src/input/thread.o x264_src/x264.o x264_src/extras/getopt.o -lm -o ../../run/run_peak_refrate_teste1-m64.0000/$3
