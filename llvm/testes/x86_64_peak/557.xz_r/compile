#!/bin/bash

LLC=~/Code/Faculdade/tcc/llvm/build/bin/llc

cd ~/Code/Faculdade/tcc/llvm/testes/x86_64_peak/557.xz_r/build/build_peak_teste1-m64.0000

find . -type f -name "*.ll" -print | xargs -P 0 -i $LLC -O3 -filetype=obj --priority-function="$2" --regalloc=$1 {}

clang -no-pie -m64 -z muldefs -Ofast -mavx spec.o spec_xz.o pxz.o common/tuklib_physmem.o liblzma/common/common.o liblzma/common/block_util.o liblzma/common/easy_preset.o liblzma/common/filter_common.o liblzma/common/hardware_physmem.o liblzma/common/index.o liblzma/common/stream_flags_common.o liblzma/common/vli_size.o liblzma/common/alone_encoder.o liblzma/common/block_buffer_encoder.o liblzma/common/block_encoder.o liblzma/common/block_header_encoder.o liblzma/common/easy_buffer_encoder.o liblzma/common/easy_encoder.o liblzma/common/easy_encoder_memusage.o liblzma/common/filter_buffer_encoder.o liblzma/common/filter_encoder.o liblzma/common/filter_flags_encoder.o liblzma/common/index_encoder.o liblzma/common/stream_buffer_encoder.o liblzma/common/stream_encoder.o liblzma/common/stream_flags_encoder.o liblzma/common/vli_encoder.o liblzma/common/alone_decoder.o liblzma/common/auto_decoder.o liblzma/common/block_buffer_decoder.o liblzma/common/block_decoder.o liblzma/common/block_header_decoder.o liblzma/common/easy_decoder_memusage.o liblzma/common/filter_buffer_decoder.o liblzma/common/filter_decoder.o liblzma/common/filter_flags_decoder.o liblzma/common/index_decoder.o liblzma/common/index_hash.o liblzma/common/stream_buffer_decoder.o liblzma/common/stream_decoder.o liblzma/common/stream_flags_decoder.o liblzma/common/vli_decoder.o liblzma/check/check.o liblzma/check/crc32_table.o liblzma/check/crc32_fast.o liblzma/check/crc64_table.o liblzma/check/crc64_fast.o liblzma/check/sha256.o liblzma/lz/lz_encoder.o liblzma/lz/lz_encoder_mf.o liblzma/lz/lz_decoder.o liblzma/lzma/lzma_encoder.o liblzma/lzma/lzma_encoder_presets.o liblzma/lzma/lzma_encoder_optimum_fast.o liblzma/lzma/lzma_encoder_optimum_normal.o liblzma/lzma/fastpos_table.o liblzma/lzma/lzma_decoder.o liblzma/lzma/lzma2_encoder.o liblzma/lzma/lzma2_decoder.o liblzma/rangecoder/price_table.o liblzma/delta/delta_common.o liblzma/delta/delta_encoder.o liblzma/delta/delta_decoder.o liblzma/simple/simple_coder.o liblzma/simple/simple_encoder.o liblzma/simple/simple_decoder.o liblzma/simple/x86.o liblzma/simple/powerpc.o liblzma/simple/ia64.o liblzma/simple/arm.o liblzma/simple/armthumb.o liblzma/simple/sparc.o xz/args.o xz/coder.o xz/file_io.o xz/hardware.o xz/list.o xz/main.o xz/message.o xz/options.o xz/signals.o xz/util.o common/tuklib_open_stdxxx.o common/tuklib_progname.o common/tuklib_exit.o common/tuklib_cpucores.o common/tuklib_mbstr_width.o common/tuklib_mbstr_fw.o spec_mem_io/spec_mem_io.o sha-2/sha512.o -o ../../run/run_peak_refrate_teste1-m64.0000/$3
